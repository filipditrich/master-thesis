@startuml
skinparam ActivityBackgroundColor #f9f9f9
skinparam ActivityBorderColor #333
skinparam ArrowColor #666
skinparam ActivityFontSize 11
skinparam NoteBorderColor #999
skinparam NoteBackgroundColor #fff
skinparam NoteFontSize 10

' Define specific activity styles
skinparam activity {
    BackgroundColor<<milestone>> #0B2A70
    FontColor<<milestone>> #FFF
    BorderColor<<milestone>> #40C8D3
}

skinparam partition {
    BackgroundColor #F3F4F8
    BorderColor #64748b
}

partition "Initial Analysis" {
    start
    :Analyze DB;
    :Select Tables;
    note right: 21 tables selected
    :Plan Export Strategy;

    split
        :Process Small Tables;
        :Direct CSV Export;
    split again
        :Process Large Tables;
        :Split in Chunks;
        :Join with Python;
        note right: e.g., Transactions table (140k+ rows)
    end split
}

partition "Preprocessing" {
    :Convert Timestamps;
    :Fix Formats;
'    note: Ensure numeric consistency
}

partition "Environment Setup" {
    :Install PostgreSQL with PostGIS;
    :Setup DB Structure;
    :Import Preprocessed Files;
    :Base Dataset Ready;<<milestone>>
}

partition "Data Enhancement" {
    split
        :Enhance Beverage Data;
        :Add Volume Info;
        note left
            - 425 products
            - 159 beverages
            - Manual entry
        end note
    split again
        :Process Returns;
        :Add Binary Flag;
    split again
        :Import Event Data;
        :Extract from Web;
        :AI-Assisted Entry;
        note right
            AI-generated
            SQL scripts
        end note
    end split
}

partition "Anonymization" {
    :Setup Tables;
    note left: Tables: config, values
    :Configure Anonymization;
    note right: JSON-driven setup

    split
        :Process Vendors;
        note left: Specific formats
    split again
        :Process Customers;
        note right: Preserve domains
    split again
        :Process Locations;
        note right
            Keep non-sensitive
            names (e.g., BAR L2)
        end note
    end split
    :Dataset Anonymized;<<milestone>>
}

partition "Analysis Prep" {
    split
        :Build Commission Calculator;
    split again
        :Transaction Enrichment View;
    split again
        :Develop Customer View;
    end split
}

:Final Dataset Ready;<<milestone>>
stop

@enduml
